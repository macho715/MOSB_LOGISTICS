
# MOSB Logistics Dashboard - κµ¬ν„ μ§„ν–‰ μƒν™© λ° κ°€μ΄λ“

**μ‘μ„±μΌ**: 2026-01-08
**ν”„λ΅μ νΈ**: MOSB Logistics Live Map MVP v2
**μ¤νƒ**: Next.js 14 + React 18 + Deck.gl 9 + MapLibre 4 + FastAPI + WebSocket

---

## λ©μ°¨

1. [ν”„λ΅μ νΈ κ°μ”](#ν”„λ΅μ νΈ-κ°μ”)
2. [Phase 1 κµ¬ν„ μ™„λ£](#phase-1-κµ¬ν„-μ™„λ£)
3. [Phase 2 κµ¬ν„ μ™„λ£](#phase-2-κµ¬ν„-μ™„λ£)
4. [Phase 3 κ³„ν μλ¦½](#phase-3-κ³„ν-μλ¦½)
5. [Phase 3.1 κµ¬ν„ μ™„λ£](#phase-31-κµ¬ν„-μ™„λ£)
6. [Phase 3.1 λ΅μ»¬ κ²€μ¦ κ²°κ³Ό](#phase-31-λ΅μ»¬-κ²€μ¦-κ²°κ³Ό)
7. [Phase 3.1 μƒμ„Έ κµ¬ν„ κ°€μ΄λ“](#phase-31-μƒμ„Έ-κµ¬ν„-κ°€μ΄λ“)
8. [μ°Έκ³  μλ£](#μ°Έκ³ -μλ£)

---

## ν”„λ΅μ νΈ κ°μ”

### κΈ°μ  μ¤νƒ

- **Frontend**: Next.js 14, React 18, Deck.gl 9, MapLibre 4
- **Backend**: FastAPI, WebSocket
- **λ°μ΄ν„°**: DuckDB with CSV fallback (Phase 3.1 μ™„λ£)
- **μΊμ‹±**: TTLCache (5min locations/shipments/legs, 1min events)
- **μ¤νƒ€μΌ**: λ‹¤ν¬ ν…λ§

### ν„μ¬ λ°μ΄ν„° κµ¬μ΅°

- **Locations**: 8κ° (MOSB, WH, SITEΓ—4, PORT, BERTH)
- **Shipments**: 2κ° (AGI, DAS)
- **Legs**: 6κ° (ROAD/SEA κµ¬κ°„)
- **Events**: 5κ° (μ›λ 3κ° + demo 2κ°)

### ν”„λ΅μ νΈ κµ¬μ΅°

```
mosb_logistics_dashboard_next_fastapi_mvp/
β”β”€β”€ frontend/
β”‚   β”β”€β”€ types/
β”‚   β”‚   β””β”€β”€ logistics.ts          # λ„λ©”μΈ νƒ€μ… μ •μ
β”‚   β”β”€β”€ lib/
β”‚   β”‚   β””β”€β”€ api.ts                # API ν΄λΌμ΄μ–ΈνΈ
β”‚   β”β”€β”€ hooks/
β”‚   β”‚   β””β”€β”€ useWebSocket.ts       # WebSocket Hook
β”‚   β””β”€β”€ pages/
β”‚       β””β”€β”€ index.tsx              # λ©”μΈ νμ΄μ§€
β””β”€β”€ backend/
    β”β”€β”€ db.py                      # DuckDB ν†µν•© (Phase 3.1)
    β”β”€β”€ cache.py                   # μΊμ‹± λ μ΄μ–΄ (Phase 3.1)
    β”β”€β”€ models.py                  # Pydantic λ¨λΈ
    β”β”€β”€ main.py                    # FastAPI μ•±
    β”β”€β”€ tests/
    β”‚   β”β”€β”€ test_main.py           # API ν…μ¤νΈ
    β”‚   β”β”€β”€ test_db.py             # DB ν…μ¤νΈ (Phase 3.1)
    β”‚   β””β”€β”€ test_cache.py          # μΊμ‹ ν…μ¤νΈ (Phase 3.1)
    β””β”€β”€ data/
        β”β”€β”€ logistics.db           # DuckDB νμΌ (Phase 3.1)
        β”β”€β”€ locations.csv
        β”β”€β”€ shipments.csv
        β”β”€β”€ legs.csv
        β””β”€β”€ events.csv
```

---

## Phase 1 κµ¬ν„ μ™„λ£

**κΈ°κ°„**: 1-2μΌ
**μƒνƒ**: β… μ™„λ£

### κµ¬ν„ λ‚΄μ©

#### 1. Frontend νƒ€μ… μ •μ (`frontend/types/logistics.ts`)

```typescript
export type LocationType = "MOSB" | "SITE" | "WH" | "PORT" | "BERTH";
export type ShipmentStatus = "PLANNED" | "IN_TRANSIT" | "ARRIVED" | "DELAYED" | "HOLD";
export type TransportMode = "ROAD" | "SEA" | "AIR";

export interface Location {
  location_id: string;
  type: LocationType;
  name: string;
  lat: number;
  lon: number;
}

export interface Shipment {
  shpt_no: string;
  bl_no: string;
  incoterm: string;
  hs_code: string;
  priority: "HIGH" | "MED" | "LOW";
  vendor: string;
}

export interface Leg {
  leg_id: string;
  shpt_no: string;
  from_location_id: string;
  to_location_id: string;
  mode: TransportMode;
  planned_etd: string;
  planned_eta: string;
}

export interface Event {
  event_id: string;
  ts: string;
  shpt_no: string;
  status: ShipmentStatus;
  location_id: string;
  lat: number;
  lon: number;
  remark: string;
}
```

#### 2. API ν΄λΌμ΄μ–ΈνΈ λ¶„λ¦¬ (`frontend/lib/api.ts`)

- μ¤‘μ•™ν™”λ API μ ‘κ·Ό
- μ—λ¬ μ²λ¦¬ ν¬ν•¨
- λ¨λ“  μ—”λ“ν¬μΈνΈ λ©”μ„λ“ κµ¬ν„

#### 3. WebSocket Hook (`frontend/hooks/useWebSocket.ts`)

- μλ™ μ¬μ—°κ²° λ΅μ§
- λ°±μ¤ν”„ μ „λµ
- μ•μ „ν• λ©”μ‹μ§€ νμ‹± (UI ν¬λμ‹ λ°©μ§€)
- μµλ€ μ¬μ—°κ²° μ‹λ„ μ ν•

#### 4. Backend μ—λ¬ μ²λ¦¬ κ°•ν™” (`backend/main.py`)

- μ „μ—­ μμ™Έ ν•Έλ“¤λ¬
- κµ¬μ΅°ν™”λ HTTPException λ§¤ν•‘
- ν™κ²½ λ³€μ κΈ°λ° CORS μ„¤μ •
- λ΅κΉ… μ‹μ¤ν…

### λ³€κ²½ νμΌ

- `frontend/types/logistics.ts` (μ‹ κ·)
- `frontend/lib/api.ts` (μ‹ κ·)
- `frontend/hooks/useWebSocket.ts` (μ‹ κ·)
- `frontend/pages/index.tsx` (λ¦¬ν©ν† λ§)
- `backend/main.py` (μ—λ¬ μ²λ¦¬ μ¶”κ°€)

---

## Phase 2 κµ¬ν„ μ™„λ£

**κΈ°κ°„**: 1μ£Ό
**μƒνƒ**: β… μ™„λ£

### κµ¬ν„ λ‚΄μ©

#### 1. Backend Pydantic λ¨λΈ (`backend/models.py`)

```python
class Location(BaseModel):
    location_id: str
    type: Literal["MOSB", "SITE", "WH", "PORT", "BERTH"]
    name: str
    lat: float = Field(..., ge=-90, le=90)
    lon: float = Field(..., ge=-180, le=180)

class Shipment(BaseModel):
    shpt_no: str
    bl_no: str
    incoterm: str
    hs_code: str
    priority: Literal["HIGH", "MED", "LOW"]
    vendor: str

class Leg(BaseModel):
    leg_id: str
    shpt_no: str
    from_location_id: str
    to_location_id: str
    mode: Literal["ROAD", "SEA", "AIR"]
    planned_etd: str
    planned_eta: str

class EventCreate(BaseModel):
    shpt_no: str
    status: Literal["PLANNED", "IN_TRANSIT", "ARRIVED", "DELAYED", "HOLD"]
    location_id: str
    lat: float = Field(..., ge=-90, le=90)
    lon: float = Field(..., ge=-180, le=180)
    remark: str = ""

class Event(EventCreate):
    event_id: str
    ts: str
```

#### 2. ν…μ¤νΈ μ½”λ“ (`backend/tests/test_main.py`)

- 6κ° ν…μ¤νΈ μΌ€μ΄μ¤ κµ¬ν„
- λ¨λ“  API μ—”λ“ν¬μΈνΈ ν…μ¤νΈ
- ν•„ν„°λ§ λ° λ°λ¨ μ΄λ²¤νΈ ν…μ¤νΈ

#### 3. ν™κ²½ λ³€μ ν…ν”λ¦Ώ

- `backend/.env.example`
- `frontend/.env.local.example`

#### 4. μμ΅΄μ„± ν™•μ¥

**backend/requirements.txt**:
```
fastapi>=0.111.0
uvicorn[standard]>=0.30.0
pydantic>=2.0.0
pydantic-settings>=2.0.0
python-dotenv>=1.0.0
pytest>=7.4.0
pytest-asyncio>=0.21.0
httpx>=0.24.0
```

**frontend/package.json**:
- `lint`, `type-check` μ¤ν¬λ¦½νΈ μ¶”κ°€
- devDependencies μ¶”κ°€ (@types/node, @types/react, eslint λ“±)

#### 5. main.py λ¨λΈ ν†µν•©

- `response_model` μ μ©
- `parse_rows` ν•¨μλ΅ μ•μ „ν• νμ‹±
- `WS_PING_INTERVAL` ν™κ²½ λ³€μ μ μ©

### λ³€κ²½ νμΌ

- `backend/models.py` (μ‹ κ·)
- `backend/tests/test_main.py` (μ‹ κ·)
- `backend/requirements.txt` (ν™•μ¥)
- `frontend/package.json` (μ¤ν¬λ¦½νΈ μ¶”κ°€)
- `backend/main.py` (λ¨λΈ ν†µν•©)
- `backend/.env.example` (μ‹ κ·)
- `frontend/.env.local.example` (μ‹ κ·)

---

## Phase 3 κ³„ν μλ¦½

**κΈ°κ°„**: 2-4μ£Ό
**μƒνƒ**: π“‹ κ³„ν μ™„λ£, κµ¬ν„ λ€κΈ°

### Phase 3 κµ¬μ„±

| ν•­λ© | λ©ν‘ | μμƒ μ‹κ°„ | μƒνƒ |
|------|------|----------|------|
| 3.1 DB μ¤€λΉ„ + μΊμ‹± | DuckDB ν†µν•©, μΊμ‹± λ μ΄μ–΄ | 1μ£Ό | β… μ™„λ£ |
| 3.2 μΈμ¦/μΈκ°€ | JWT + RBAC | 1μ£Ό | π“‹ λ€κΈ° |
| 3.3 μ„±λ¥ μµμ ν™” | μ„λ²„/ν΄λΌμ΄μ–ΈνΈ μΊμ‹±, React μµμ ν™” | 3-5μΌ | π“‹ λ€κΈ° |
| 3.4 CI/CD νμ΄ν”„λΌμΈ | GitHub Actions, Pre-commit | 3-5μΌ | π“‹ λ€κΈ° |

### Phase 3.1: DB μ¤€λΉ„ + μΊμ‹±

#### λ©ν‘
- CSVμ—μ„ DuckDBλ΅ λ§μ΄κ·Έλ μ΄μ…
- μΊμ‹± λ μ΄μ–΄ μ¶”κ°€
- κΈ°μ΅΄ API νΈν™μ„± μ μ§€

#### λ°μ΄ν„°λ² μ΄μ¤ μ„ νƒ: DuckDB (MVP κ¶μ¥)

**μ¥μ **:
- νμΌ κΈ°λ°, μ„¤μΉ λ¶ν•„μ”
- CSV μ„ν¬νΈ κ°„λ‹¨
- SQL μΏΌλ¦¬ μ§€μ›
- λΉ λ¥Έ λ¶„μ„ μΏΌλ¦¬

**λ‹¨μ **:
- λ™μ‹ μ“°κΈ° μ ν•
- ν”„λ΅λ•μ… ν™•μ¥μ„± μ ν•

#### κµ¬ν„ κ³„ν

1. **DuckDB ν†µν•©** (1-2μΌ)
   - `backend/db.py` μƒμ„±
   - μ¤ν‚¤λ§ μ΄κΈ°ν™”
   - CSV λ°μ΄ν„° μλ™ λ΅λ“

2. **μΊμ‹± λ μ΄μ–΄** (1μΌ)
   - `backend/cache.py` μƒμ„±
   - TTLCache μ‚¬μ©
   - μΊμ‹ λ¬΄ν¨ν™” λ΅μ§

3. **main.py ν†µν•©** (1μΌ)
   - DB μΈμ¤ν„΄μ¤ μƒμ„±
   - μΊμ‹ μ μ©
   - κΈ°μ΅΄ API νΈν™μ„± μ μ§€

4. **ν…μ¤νΈ μ¶”κ°€** (1μΌ)
   - DB ν…μ¤νΈ
   - μΊμ‹ ν…μ¤νΈ

### Phase 3.2: μΈμ¦/μΈκ°€ (JWT) + RBAC

#### λ©ν‘
- JWT κΈ°λ° μΈμ¦
- μ—­ν•  κΈ°λ° μ ‘κ·Ό μ μ–΄ (Ops/Finance/Compliance/Admin)
- λ³΄νΈλ μ—”λ“ν¬μΈνΈ

#### κµ¬ν„ κ³„ν

1. **JWT μΈμ¦** (2μΌ)
   - `backend/auth.py` μƒμ„±
   - λ΅κ·ΈμΈ μ—”λ“ν¬μΈνΈ
   - ν† ν° κ²€μ¦

2. **RBAC λ°μ½”λ μ΄ν„°** (1μΌ)
   - `backend/rbac.py` μƒμ„±
   - μ—­ν•  κΈ°λ° μ ‘κ·Ό μ μ–΄

3. **Frontend ν†µν•©** (2μΌ)
   - `frontend/lib/auth.ts` μƒμ„±
   - API ν΄λΌμ΄μ–ΈνΈμ— μΈμ¦ ν—¤λ” μ¶”κ°€
   - λ΅κ·ΈμΈ UI (μ„ νƒ)

### Phase 3.3: μ„±λ¥ μµμ ν™”

#### λ©ν‘
- μ„λ²„ μΊμ‹± μµμ ν™”
- ν΄λΌμ΄μ–ΈνΈ λ©”λ¨μ΄μ μ΄μ…
- React μµμ ν™”

#### κµ¬ν„ κ³„ν

1. **μ„λ²„ μΊμ‹± κ°μ„ ** (1μΌ)
   - λ°μ½”λ μ΄ν„° κΈ°λ° μΊμ‹±
   - μΊμ‹ ν‚¤ μƒμ„± μµμ ν™”

2. **ν΄λΌμ΄μ–ΈνΈ λ©”λ¨μ΄μ μ΄μ…** (1μΌ)
   - `frontend/hooks/useMemoizedData.ts` μƒμ„±
   - ν΄λΌμ΄μ–ΈνΈ μΊμ‹ κ΄€λ¦¬

3. **React μµμ ν™”** (1μΌ)
   - `memo` μ‚¬μ©
   - `useMemo` μµμ ν™”

### Phase 3.4: CI/CD νμ΄ν”„λΌμΈ

#### λ©ν‘
- GitHub Actions μ›ν¬ν”λ΅μ°
- μλ™ ν…μ¤νΈ μ‹¤ν–‰
- Pre-commit ν›…

#### κµ¬ν„ κ³„ν

1. **GitHub Actions** (2μΌ)
   - Backend ν…μ¤νΈ μ›ν¬ν”λ΅μ°
   - Frontend λΉλ“ μ›ν¬ν”λ΅μ°
   - μ»¤λ²„λ¦¬μ§€ λ¦¬ν¬νΈ

2. **Pre-commit ν›…** (1μΌ)
   - Black ν¬λ§·ν…
   - Ruff λ¦°ν…
   - ν…μ¤νΈ μ‹¤ν–‰

---

## Phase 3.1 κµ¬ν„ μ™„λ£

**κΈ°κ°„**: 1μ£Ό
**μƒνƒ**: β… μ™„λ£ (2026-01-08)

### κµ¬ν„ λ‚΄μ©

#### 1. DuckDB ν†µν•© (`backend/db.py`)

**μ£Όμ” κΈ°λ¥**:
- μ¤ν‚¤λ§ μλ™ μ΄κΈ°ν™” (locations, shipments, legs, events)
- CSV μλ™ λ΅λ“ (`read_csv` with `all_varchar=true`, `strict_mode=false`)
- ν™κ²½ λ³€μ κΈ°λ° DB κ²½λ΅ μ„¤μ • (`LOGISTICS_DB_PATH`)
- λ©”λ¨λ¦¬ DB μ§€μ› (ν…μ¤νΈμ© `:memory:`)

**νΉμ§•**:
- CSV λ°μ΄ν„°κ°€ μ—†μ–΄λ„ λ™μ‘ (λΉ ν…μ΄λΈ”λ΅ μ‹μ‘)
- νƒ€μ… μ•μ „ν• λ¨λΈ λ³€ν™ (`_fetch_models` ν—¬νΌ)
- μ΄λ²¤νΈ ν•„ν„°λ§ μ§€μ› (`since` νλΌλ―Έν„°)
- CSV fallback μ μ§€ (ν•μ„ νΈν™μ„±)

#### 2. μΊμ‹± λ μ΄μ–΄ (`backend/cache.py`)

**μ£Όμ” κΈ°λ¥**:
- TTLCache κΈ°λ° μΊμ‹±
  - Locations/Shipments/Legs: 5λ¶„ TTL
  - Events: 1λ¶„ TTL
- κ°λ³„ μΊμ‹ λ¬΄ν¨ν™” λ©”μ„λ“
- `cache_response` λ°μ½”λ μ΄ν„° (async/sync μλ™ κ°μ§€)

**νΉμ§•**:
- μΊμ‹ ν‚¤λ” ν•¨μλ… + μΈμ κΈ°λ° MD5 ν•΄μ‹
- λ™κΈ°/λΉ„λ™κΈ° ν•¨μ λ¨λ‘ μ§€μ›
- μΊμ‹ λ¬΄ν¨ν™” API μ κ³µ

#### 3. main.py ν†µν•©

**λ³€κ²½μ‚¬ν•­**:
- DB μΈμ¤ν„΄μ¤ μ „μ—­ μƒμ„±
- μΊμ‹ λ§¤λ‹μ € μ „μ—­ μƒμ„±
- λ¨λ“  μ—”λ“ν¬μΈνΈμ— DB + μΊμ‹ μ μ©
- CSV fallback μ μ§€ (DB λ΅λ“ μ‹¤ν¨ μ‹)

**μ΄λ²¤νΈ μ²λ¦¬**:
- Demo μ΄λ²¤νΈ: DB μ €μ¥ β†’ μΊμ‹ λ¬΄ν¨ν™” β†’ CSV append (ν•μ„ νΈν™μ„±)

#### 4. ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€

**test_db.py**:
- DB μ—°κ²° ν…μ¤νΈ
- Location μ΅°ν ν…μ¤νΈ
- Events ν•„ν„°λ§ ν…μ¤νΈ (`since` νλΌλ―Έν„°)
- Event μ¶”κ°€ ν…μ¤νΈ

**test_cache.py**:
- μΊμ‹ ννΈ/λ―Έμ¤ ν…μ¤νΈ
- TTL λ§λ£ ν…μ¤νΈ
- μΊμ‹ λ¬΄ν¨ν™” ν…μ¤νΈ

### λ³€κ²½ νμΌ

- `backend/db.py` (μ‹ κ·, 201μ¤„)
- `backend/cache.py` (μ‹ κ·, 93μ¤„)
- `backend/main.py` (μμ •, +67/-18)
- `backend/tests/test_db.py` (μ‹ κ·, 63μ¤„)
- `backend/tests/test_cache.py` (μ‹ κ·, 35μ¤„)
- `backend/requirements.txt` (+2: duckdb, cachetools)
- `backend/.env.example` (+1: LOGISTICS_DB_PATH)
- `docs/AGENTS.md` (μ—…λ°μ΄νΈ)

### ν™κ²½ λ³€μ μ¶”κ°€

```bash
# backend/.env.example
LOGISTICS_DB_PATH=./data/logistics.db  # Optional, defaults to data/logistics.db
```

---

## Phase 3.1 λ΅μ»¬ κ²€μ¦ κ²°κ³Ό

**κ²€μ¦ μΌμ‹**: 2026-01-08
**κ²€μ¦ ν™κ²½**: Windows, Python 3.13, FastAPI 0.119.0

### κ²€μ¦ ν•­λ© λ° κ²°κ³Ό

#### 1. μμ΅΄μ„± ν™•μΈ β…

```
duckdb: 1.3.2
cachetools: 5.5.0
fastapi: 0.119.0
```

#### 2. API μ„λ²„ μ‹¤ν–‰ β…

- μ„λ²„κ°€ `http://localhost:8000`μ—μ„ μ •μƒ μ‹¤ν–‰
- λ¨λ“  μ—”λ“ν¬μΈνΈ μ •μƒ μ‘λ‹µ

#### 3. DB νμΌ μƒμ„± ν™•μΈ β…

- `data/logistics.db` νμΌ μƒμ„± ν™•μΈ
- νμΌ ν¬κΈ°: 12,288 bytes

#### 4. API μ—”λ“ν¬μΈνΈ ν…μ¤νΈ β…

| μ—”λ“ν¬μΈνΈ | μμƒ | μ‹¤μ  | μƒνƒ |
|-----------|------|------|------|
| `/api/locations` | 8κ° | 8κ° | β… |
| `/api/shipments` | 2κ° | 2κ° | β… |
| `/api/legs` | 6κ° | 6κ° | β… |
| `/api/events` | 3+κ° | 5κ° | β… |

**μ‘λ‹µ μμ‹** (`/api/locations`):
```json
[
  {
    "location_id": "MOSB_ESNAAD",
    "type": "MOSB",
    "name": "MOSB - Samsung HVDC Lightning Project Esnaad",
    "lat": 24.328853,
    "lon": 54.45857
  },
  ...
]
```

#### 5. μΊμ‹ λ™μ‘ ν™•μΈ β…

**μ„±λ¥ μΈ΅μ • κ²°κ³Ό**:
- μ²« λ²μ§Έ μ”μ²­ (μΊμ‹ λ―Έμ¤): 4117ms
- λ‘ λ²μ§Έ μ”μ²­ (μΊμ‹ ννΈ): 2049ms
- **μΊμ‹ ν¨κ³Ό**: μ•½ 2λ°° λΉ λ¦„ β…

#### 6. μ΄λ²¤νΈ μƒμ„± λ° μ €μ¥ ν™•μΈ β…

**Demo μ΄λ²¤νΈ μƒμ„±**:
- Event ID: `EV-6f7bfa4c`
- Status: `IN_TRANSIT`
- Shipment: `SHPT-AGI-0001`

**μ €μ¥ ν™•μΈ**:
- β… DBμ— μ €μ¥λ¨
- β… CSV νμΌμ— μ¶”κ°€λ¨:
  ```
  EV-6f7bfa4c,2026-01-08T19:48:00+00:00,SHPT-AGI-0001,IN_TRANSIT,MOSB_ESNAAD,24.328853,54.45857,Demo tick
  ```

### κ²€μ¦ μ²΄ν¬λ¦¬μ¤νΈ

- [x] API μ„λ²„ μ •μƒ μ‹¤ν–‰
- [x] DB νμΌ μƒμ„± ν™•μΈ
- [x] Locations μ—”λ“ν¬μΈνΈ (8κ°)
- [x] Shipments μ—”λ“ν¬μΈνΈ (2κ°)
- [x] Legs μ—”λ“ν¬μΈνΈ (6κ°)
- [x] Events μ—”λ“ν¬μΈνΈ (5κ°)
- [x] μΊμ‹ λ™μ‘ ν™•μΈ (μ•½ 2λ°° λΉ λ¦„)
- [x] Demo μ΄λ²¤νΈ μƒμ„± μ„±κ³µ
- [x] CSV νμΌμ— μ΄λ²¤νΈ μ¶”κ°€ ν™•μΈ

### μ•λ ¤μ§„ μ΄μ

#### DuckDB νμΌ μ§μ ‘ μ ‘κ·Ό μ¤λ¥

**μ¦μƒ**: Python μ¤ν¬λ¦½νΈλ΅ DuckDB νμΌ μ§μ ‘ μ ‘κ·Ό μ‹ `UnicodeDecodeError` λ°μƒ

**μ›μΈ**:
- νμΌμ΄ μ΄λ―Έ μ—΄λ ¤μκ±°λ‚ μ κ²¨μμ„ μ μμ
- κ²½λ΅ μΈμ½”λ”© λ¬Έμ  κ°€λ¥μ„±

**μν–¥**:
- APIλ¥Ό ν†µν• μ ‘κ·Όμ€ μ •μƒ λ™μ‘
- μ§μ ‘ νμΌ μ ‘κ·Όλ§ μ ν•λ¨

**ν•΄κ²°μ±…**:
- API μ„λ²„λ¥Ό ν†µν• μ ‘κ·Ό μ‚¬μ© (κ¶μ¥)
- λλ” API μ„λ²„ μΆ…λ£ ν›„ νμΌ μ ‘κ·Ό

### κ²€μ¦ λ…λ Ήμ–΄

```bash
# API μ„λ²„ μ‹¤ν–‰
cd mosb_logistics_dashboard_next_fastapi_mvp/backend
uvicorn main:app --reload --port 8000

# μ—”λ“ν¬μΈνΈ ν…μ¤νΈ
curl http://localhost:8000/api/locations
curl http://localhost:8000/api/shipments
curl http://localhost:8000/api/legs
curl http://localhost:8000/api/events

# Demo μ΄λ²¤νΈ μƒμ„±
curl -X POST http://localhost:8000/api/events/demo

# μΊμ‹ μ„±λ¥ ν…μ¤νΈ
# μ²« λ²μ§Έ μ”μ²­ ν›„ λ‘ λ²μ§Έ μ”μ²­μ΄ λ” λΉ λ¥Έμ§€ ν™•μΈ
```

### κ²°λ΅ 

**Phase 3.1 κµ¬ν„μ΄ μ •μƒμ μΌλ΅ μ™„λ£λμ—μµλ‹λ‹¤**:
- β… DuckDB ν†µν•© μ™„λ£
- β… μΊμ‹± λ μ΄μ–΄ λ™μ‘ ν™•μΈ
- β… CSV fallback μ μ§€
- β… μ΄λ²¤νΈ μƒμ„± λ° μ €μ¥ μ •μƒ
- β… λ¨λ“  API μ—”λ“ν¬μΈνΈ μ •μƒ λ™μ‘
- β… μΊμ‹ μ„±λ¥ κ°μ„  ν™•μΈ (μ•½ 2λ°°)

---

## Phase 3.1 μƒμ„Έ κµ¬ν„ κ°€μ΄λ“

### Step 1: μμ΅΄μ„± μ¶”κ°€

```txt
# backend/requirements.txtμ— μ¶”κ°€
duckdb>=0.9.0
cachetools>=5.3.0
```

### Step 2: λ°μ΄ν„°λ² μ΄μ¤ λ¨λ“ μƒμ„±

**νμΌ**: `backend/db.py`

μ£Όμ” κΈ°λ¥:
- DuckDB μ—°κ²° κ΄€λ¦¬
- μ¤ν‚¤λ§ μ΄κΈ°ν™”
- CSV λ°μ΄ν„° μλ™ λ΅λ“
- CRUD λ©”μ„λ“

### Step 3: μΊμ‹± λ¨λ“ μƒμ„±

**νμΌ**: `backend/cache.py`

μ£Όμ” κΈ°λ¥:
- TTLCache κ΄€λ¦¬
- μΊμ‹ ννΈ/λ―Έμ¤ μ²λ¦¬
- μΊμ‹ λ¬΄ν¨ν™”

### Step 4: main.py ν†µν•©

μ£Όμ” λ³€κ²½μ‚¬ν•­:
- DB μΈμ¤ν„΄μ¤ μƒμ„±
- μΊμ‹ λ§¤λ‹μ € μƒμ„±
- μ—”λ“ν¬μΈνΈμ— μΊμ‹± μ μ©
- μ΄λ²¤νΈ μ¶”κ°€ μ‹ μΊμ‹ λ¬΄ν¨ν™”

### Step 5: ν…μ¤νΈ μ¶”κ°€

**νμΌ**:
- `backend/tests/test_db.py`
- `backend/tests/test_cache.py`

### μ‹¤ν–‰ μμ„

1. μμ΅΄μ„± μ„¤μΉ: `pip install -r requirements.txt`
2. νμΌ μƒμ„±: `db.py`, `cache.py`, ν…μ¤νΈ νμΌ
3. `main.py` μμ •
4. ν…μ¤νΈ μ‹¤ν–‰: `pytest -q -v`
5. μλ™ ν…μ¤νΈ: API μ—”λ“ν¬μΈνΈ ν™•μΈ

### κ²€μ¦ μ²΄ν¬λ¦¬μ¤νΈ (μ°Έκ³ μ©)

- [x] `duckdb` λ° `cachetools` μ„¤μΉ ν™•μΈ
- [x] `db.py` λ¨λ“ μƒμ„± λ° ν…μ¤νΈ ν†µκ³Ό
- [x] `cache.py` λ¨λ“ μƒμ„± λ° ν…μ¤νΈ ν†µκ³Ό
- [x] `main.py` ν†µν•© ν›„ κΈ°μ΅΄ API λ™μ‘ ν™•μΈ
- [x] μΊμ‹ λ™μ‘ ν™•μΈ
- [x] DBμ— λ°μ΄ν„° μ €μ¥ ν™•μΈ
- [x] λ¨λ“  ν…μ¤νΈ ν†µκ³Ό

---

## μ°Έκ³  μλ£

### ν”„λ΅μ νΈ λ¬Έμ„

- `docs/AGENTS.md` - ν”„λ΅μ νΈ μ•„ν‚¤ν…μ² κ°€μ΄λ“
- `docs/constitution.md` - ν”„λ΅μ νΈ κ·μΉ™
- `mosb_logistics_dashboard_next_fastapi_mvp/README.txt` - μ‹¤ν–‰ κ°€μ΄λ“

### μ£Όμ” λ…λ Ήμ–΄

```bash
# Backend μ‹¤ν–‰
cd mosb_logistics_dashboard_next_fastapi_mvp/backend
pip install -r requirements.txt
uvicorn main:app --reload --port 8000

# Backend ν…μ¤νΈ
pytest -q -v

# Frontend μ‹¤ν–‰
cd mosb_logistics_dashboard_next_fastapi_mvp/frontend
npm install
npm run dev

# Frontend νƒ€μ… μ²΄ν¬
npm run type-check

# Frontend λ¦°νΈ
npm run lint
```

### ν™κ²½ λ³€μ

**Backend** (`.env`):
```
DATA_DIR=./data
LOGISTICS_DB_PATH=./data/logistics.db
CORS_ORIGINS=http://localhost:3000
LOG_LEVEL=INFO
WS_PING_INTERVAL=10
```

**Frontend** (`.env.local`):
```
NEXT_PUBLIC_API_BASE=http://localhost:8000
NEXT_PUBLIC_WS_RECONNECT_DELAY=3000
NEXT_PUBLIC_WS_MAX_RECONNECT_ATTEMPTS=10
```

---

## λ‹¤μ λ‹¨κ³„

1. **Phase 3.2 κµ¬ν„ μ‹μ‘** - μΈμ¦/μΈκ°€ (JWT) + RBAC
2. **μ„±λ¥ λ¨λ‹ν„°λ§** - μ‘λ‹µ μ‹κ°„ μΈ΅μ • λ° μµμ ν™”
3. **ν”„λ΅λ•μ… μ¤€λΉ„** - ν™κ²½ λ³€μ μ„¤μ •, λ³΄μ• κ°•ν™”

---

## λ³€κ²½ μ΄λ ¥

- **2026-01-08**: Phase 1, 2 κµ¬ν„ μ™„λ£ λ¬Έμ„ν™”
- **2026-01-08**: Phase 3 κ³„ν μλ¦½
- **2026-01-08**: Phase 3.1 μƒμ„Έ κµ¬ν„ κ°€μ΄λ“ μ‘μ„±
- **2026-01-08**: Phase 3.1 κµ¬ν„ μ™„λ£ λ° λ΅μ»¬ κ²€μ¦ κ²°κ³Ό μ¶”κ°€

---

**λ¬Έμ„ λ²„μ „**: 1.1
**μµμΆ… μ—…λ°μ΄νΈ**: 2026-01-08
```

μ΄ λ¬Έμ„λ¥Ό `docs/Implementation_Progress.md`μ— μ €μ¥ν•μ„Έμ”.

ν„μ¬ "ask mode"μ΄λ―€λ΅ νμΌ μƒμ„±μ΄ ν•„μ”ν•λ©΄ "agent mode"λ΅ μ „ν™ν•κ±°λ‚, μ„ λ§ν¬λ‹¤μ΄μ„ λ³µμ‚¬ν•΄ μ§μ ‘ μ €μ¥ν•μ„Έμ”.

λ¬Έμ„ μ„μΉ: `docs/Implementation_Progress.md`

μ¶”κ°€λ΅ ν•„μ”ν• λ‚΄μ©μ΄ μμΌλ©΄ μ•λ ¤μ£Όμ„Έμ”.
